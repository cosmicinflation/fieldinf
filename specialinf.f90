module specialprec
  use infprec, only : kp
  implicit none
  integer, parameter :: dp = selected_real_kind(12,60)
!  integer, parameter :: dp = kp
end module specialprec


module specialinf
  use specialprec, only : dp,kp
  implicit none
contains

  function hypergeom_2F1(a,b,c,z)
    implicit none
    real(dp), intent(in) :: a,b,c,z
    real(dp) :: hypergeom_2F1
    complex(dp) :: ac,bc,cc,zc
    complex(dp) :: HYP_2F1,res

    ac = cmplx(a,0,dp)
    bc = cmplx(b,0,dp)
    cc = cmplx(c,0,dp)
    zc = cmplx(z,0,dp)

    res = HYP_2F1(ac,bc,cc,zc)

    hypergeom_2F1  = real(res,dp)


  end function hypergeom_2F1


   function lambertw(x)
    implicit none
    real(kp) :: lambertw
    real(kp), intent(in) :: x
    real(kp) :: w,wTimesExpW,wPlusOneTimesExpW
    real(kp), parameter :: tol=1d-15

!rough estimation

    if ((x.le.500._kp).and.(x.ge.0._kp)) then
       w = 0.665_kp * (1._kp + 0.0195*log(x+1._kp)) &
            *log(x+1._kp) + 0.04_kp
    elseif (x.gt.500._kp) then
       w = log(x-4._kp) - (1._kp - 1._kp/log(x)) &
            *log(log(x))
    elseif (x.ge.-1._kp/exp(1._kp)) then
       w=-0.5
    else
       stop 'x<-1/e'
    endif

!recurrence
       
    do
       wTimesExpW = w*exp(w)
       wPlusOneTimesExpW = (w+1._kp)*exp(w)
       if (tol.gt.(abs((x-wTimesExpW)/wPlusOneTimesExpW))) then
          exit
       else
          w = w-(wTimesExpW-x) &
               /(wPlusOneTimesExpW-(w+2._kp)*(wTimesExpW-x) &
               /(2._kp*w+2._kp))
       endif
    enddo
    
    lambertw = w
    
  end function lambertw







!DECK DLI
! Code converted using TO_F90 by Alan Miller
! Date: 2002-02-26  Time: 16:43:57
    FUNCTION dli(x) RESULT(fn_val)
!***BEGIN PROLOGUE  DLI
!***PURPOSE  Compute the logarithmic integral.
!***LIBRARY   SLATEC (FNLIB)
!***CATEGORY  C5
!***TYPE      REAL (dp) (ALI-S, DLI-D)
!***KEYWORDS  FNLIB, LOGARITHMIC INTEGRAL, SPECIAL FUNCTIONS
!***AUTHOR  Fullerton, W., (LANL)
!***DESCRIPTION
! DLI(X) calculates the REAL (dp) logarithmic integral
! for REAL (dp) argument X.
!***REFERENCES  (NONE)
!***ROUTINES CALLED  DEI, XERMSG
!***REVISION HISTORY  (YYMMDD)
!   770701  DATE WRITTEN
!   890531  Changed all specific intrinsics to generic.  (WRB)
!   890531  REVISION DATE from Version 3.2
!   891214  Prologue converted to Version 4.0 format.  (BAB)
!   900315  CALLs to XERROR changed to CALLs to XERMSG.  (THJ)
!***END PROLOGUE  DLI
      REAL (dp), INTENT(IN)  :: x
      REAL (dp)              :: fn_val
!***FIRST EXECUTABLE STATEMENT  DLI
      IF (x <= 0.d0) CALL xermsg('SLATEC', 'DLI', 'LOG INTEGRAL UNDEFINED FOR X <= 0')
      IF (x == 1.d0) CALL xermsg('SLATEC', 'DLI', 'LOG INTEGRAL UNDEFINED FOR X = 0')
      fn_val = dei(LOG(x))
      RETURN
    END FUNCTION dli
!DECK DCSEVL
    FUNCTION dcsevl(x, cs, n) RESULT(fn_val)
!***BEGIN PROLOGUE  DCSEVL
!***PURPOSE  Evaluate a Chebyshev series.
!***LIBRARY   SLATEC (FNLIB)
!***CATEGORY  C3A2
!***TYPE      REAL (dp) (CSEVL-S, DCSEVL-D)
!***KEYWORDS  CHEBYSHEV SERIES, FNLIB, SPECIAL FUNCTIONS
!***AUTHOR  Fullerton, W., (LANL)
!***DESCRIPTION
!  Evaluate the N-term Chebyshev series CS at X.  Adapted from
!  a method presented in the paper by Broucke referenced below.
!       Input Arguments --
!  X    value at which the series is to be evaluated.
!  CS   array of N terms of a Chebyshev series.  In evaluating
!       CS, only half the first coefficient is summed.
!  N    number of terms in array CS.
!***REFERENCES  R. Broucke, Ten subroutines for the manipulation of Chebyshev
!                 series, Algorithm 446, Communications of the A.C.M. 16,
!                 (1973) pp. 254-256.
!               L. Fox and I. B. Parker, Chebyshev Polynomials in Numerical
!                 Analysis, Oxford University Press, 1968, page 56.
!***ROUTINES CALLED  D1MACH, XERMSG
!***REVISION HISTORY  (YYMMDD)
!   770401  DATE WRITTEN
!   890831  Modified array declarations.  (WRB)
!   890831  REVISION DATE from Version 3.2
!   891214  Prologue converted to Version 4.0 format.  (BAB)
!   900315  CALLs to XERROR changed to CALLs to XERMSG.  (THJ)
!   900329  Prologued revised extensively and code rewritten to allow
!           X to be slightly outside interval (-1,+1).  (WRB)
!   920501  Reformatted the REFERENCES section.  (WRB)
!***END PROLOGUE  DCSEVL
REAL (dp), INTENT(IN)  :: x
REAL (dp), INTENT(IN)  :: cs(:)
INTEGER, INTENT(IN)    :: n
REAL (dp)              :: fn_val
REAL (dp)        :: b0, b1, b2, twox
REAL (dp), SAVE  :: onepl
LOGICAL, SAVE    :: first = .TRUE.
INTEGER          :: i, ni
!***FIRST EXECUTABLE STATEMENT  DCSEVL
IF (first) onepl = 1.0_dp + 2*EPSILON(0.0_dp)
first = .false.
IF (n < 1) CALL xermsg('SLATEC','DCSEVL', 'NUMBER OF TERMS <= 0')
IF (n > 1000) CALL xermsg('SLATEC', 'DCSEVL', 'NUMBER OF TERMS > 1000')
IF (ABS(x) > onepl) CALL xermsg('SLATEC','DCSEVL', 'X OUTSIDE THE INTERVAL (-1,+1)')
b1 = 0.0_dp
b0 = 0.0_dp
twox = 2.0_dp * x
DO  i = 1, n
  b2 = b1
  b1 = b0
  ni = n + 1 - i
  b0 = twox * b1 - b2 + cs(ni)
END DO
fn_val = 0.5_dp * (b0-b2)
RETURN
END FUNCTION dcsevl
!DECK DE1
FUNCTION de1(x) RESULT(fn_val)
!***BEGIN PROLOGUE  DE1
!***PURPOSE  Compute the exponential integral E1(X).
!***LIBRARY   SLATEC (FNLIB)
!***CATEGORY  C5
!***TYPE      REAL (dp) (E1-S, DE1-D)
!***KEYWORDS  E1 FUNCTION, EXPONENTIAL INTEGRAL, FNLIB,
!             SPECIAL FUNCTIONS
!***AUTHOR  Fullerton, W., (LANL)
!***DESCRIPTION
! DE1 calculates the REAL (dp) exponential integral, E1(X), for positive
! REAL (dp) argument X and the Cauchy principal value for negative X.
! If principal values are used everywhere, then, for all X,
!    E1(X) = -Ei(-X)
! or
!    Ei(X) = -E1(-X).
! Series for AE10       on the interval -3.12500E-02 to  0.
!                                        with weighted error   4.62E-32
!                                         log weighted error  31.34
!                               significant figures required  29.70
!                                    decimal places required  32.18
! Series for AE11       on the interval -1.25000E-01 to -3.12500E-02
!                                        with weighted error   2.22E-32
!                                         log weighted error  31.65
!                               significant figures required  30.75
!                                    decimal places required  32.54
! Series for AE12       on the interval -2.50000E-01 to -1.25000E-01
!                                        with weighted error   5.19E-32
!                                         log weighted error  31.28
!                               significant figures required  30.82
!                                    decimal places required  32.09
! Series for E11        on the interval -4.00000E+00 to -1.00000E+00
!                                        with weighted error   8.49E-34
!                                         log weighted error  33.07
!                               significant figures required  34.13
!                                    decimal places required  33.80
! Series for E12        on the interval -1.00000E+00 to  1.00000E+00
!                                        with weighted error   8.08E-33
!                                         log weighted error  32.09
!                        approx significant figures required  30.4
!                                    decimal places required  32.79
! Series for AE13       on the interval  2.50000E-01 to  1.00000E+00
!                                        with weighted error   6.65E-32
!                                         log weighted error  31.18
!                               significant figures required  30.69
!                                    decimal places required  32.03
! Series for AE14       on the interval  0.          to  2.50000E-01
!                                        with weighted error   5.07E-32
!                                         log weighted error  31.30
!                               significant figures required  30.40
!                                    decimal places required  32.20
!***REFERENCES  (NONE)
!***ROUTINES CALLED  D1MACH, DCSEVL, INITDS, XERMSG
!***REVISION HISTORY  (YYMMDD)
!   770701  DATE WRITTEN
!   890531  Changed all specific intrinsics to generic.  (WRB)
!   891115  Modified prologue description.  (WRB)
!   891115  REVISION DATE from Version 3.2
!   891214  Prologue converted to Version 4.0 format.  (BAB)
!   900315  CALLs to XERROR changed to CALLs to XERMSG.  (THJ)
!   920618  Removed space from variable names.  (RWC, WRB)
!***END PROLOGUE  DE1
REAL (dp), INTENT(IN)  :: x
REAL (dp)              :: fn_val
REAL (dp)        :: eta, xmaxt
REAL (dp), SAVE  :: xmax
INTEGER, SAVE    :: ntae10, ntae11, ntae12, nte11, nte12, ntae13, ntae14
LOGICAL, SAVE    :: first = .TRUE.
REAL (dp), PARAMETER  :: ae10cs(50) = (/ +.3284394579616699087873844201881E-1_dp, &
 -.1669920452031362851476184343387E-1_dp, +.2845284724361346807424899853252E-3_dp,   &
 -.7563944358516206489487866938533E-5_dp, +.2798971289450859157504843180879E-6_dp,   &
 -.1357901828534531069525563926255E-7_dp, +.8343596202040469255856102904906E-9_dp,   &
 -.6370971727640248438275242988532E-10_dp, +.6007247608811861235760831561584E-11_dp, &
 -.7022876174679773590750626150088E-12_dp, +.1018302673703687693096652346883E-12_dp, &
 -.1761812903430880040406309966422E-13_dp, +.3250828614235360694244030353877E-14_dp, &
 -.5071770025505818678824872259044E-15_dp, +.1665177387043294298172486084156E-16_dp, &
 +.3166753890797514400677003536555E-16_dp, -.1588403763664141515133118343538E-16_dp, &
 +.4175513256138018833003034618484E-17_dp, -.2892347749707141906710714478852E-18_dp, &
 -.2800625903396608103506340589669E-18_dp, +.1322938639539270903707580023781E-18_dp, &
 -.1804447444177301627283887833557E-19_dp, -.7905384086522616076291644817604E-20_dp, &
 +.4435711366369570103946235838027E-20_dp, -.4264103994978120868865309206555E-21_dp, &
 -.3920101766937117541553713162048E-21_dp, +.1527378051343994266343752326971E-21_dp, &
 +.1024849527049372339310308783117E-22_dp, -.2134907874771433576262711405882E-22_dp, &
 +.3239139475160028267061694700366E-23_dp, +.2142183762299889954762643168296E-23_dp, &
 -.8234609419601018414700348082312E-24_dp, -.1524652829645809479613694401140E-24_dp, &
 +.1378208282460639134668480364325E-24_dp, +.2131311202833947879523224999253E-26_dp, &
 -.2012649651526484121817466763127E-25_dp, +.1995535662263358016106311782673E-26_dp, &
 +.2798995808984003464948686520319E-26_dp, -.5534511845389626637640819277823E-27_dp, &
 -.3884995396159968861682544026146E-27_dp, +.1121304434507359382850680354679E-27_dp, &
 +.5566568152423740948256563833514E-28_dp, -.2045482929810499700448533938176E-28_dp, &
 -.8453813992712336233411457493674E-29_dp, +.3565758433431291562816111116287E-29_dp, &
 +.1383653872125634705539949098871E-29_dp, -.6062167864451372436584533764778E-30_dp, &
 -.2447198043989313267437655119189E-30_dp, +.1006850640933998348011548180480E-30_dp, &
 +.4623685555014869015664341461674E-31_dp /)
REAL (dp), PARAMETER  :: ae11cs(60) = (/ +.20263150647078889499401236517381_dp,  &
 -.73655140991203130439536898728034E-1_dp, +.63909349118361915862753283840020E-2_dp,   &
 -.60797252705247911780653153363999E-3_dp, -.73706498620176629330681411493484E-4_dp,   &
 +.48732857449450183453464992488076E-4_dp, -.23837064840448290766588489460235E-5_dp,   &
 -.30518612628561521027027332246121E-5_dp, +.17050331572564559009688032992907E-6_dp,   &
 +.23834204527487747258601598136403E-6_dp, +.10781772556163166562596872364020E-7_dp,   &
 -.17955692847399102653642691446599E-7_dp, -.41284072341950457727912394640436E-8_dp,   &
 +.68622148588631968618346844526664E-9_dp, +.53130183120506356147602009675961E-9_dp,   &
 +.78796880261490694831305022893515E-10_dp, -.26261762329356522290341675271232E-10_dp, &
 -.15483687636308261963125756294100E-10_dp, -.25818962377261390492802405122591E-11_dp, &
 +.59542879191591072658903529959352E-12_dp, +.46451400387681525833784919321405E-12_dp, &
 +.11557855023255861496288006203731E-12_dp, -.10475236870835799012317547189670E-14_dp, &
 -.11896653502709004368104489260929E-13_dp, -.47749077490261778752643019349950E-14_dp, &
 -.81077649615772777976249734754135E-15_dp, +.13435569250031554199376987998178E-15_dp, &
 +.14134530022913106260248873881287E-15_dp, +.49451592573953173115520663232883E-16_dp, &
 +.79884048480080665648858587399367E-17_dp, -.14008632188089809829248711935393E-17_dp, &
 -.14814246958417372107722804001680E-17_dp, -.55826173646025601904010693937113E-18_dp, &
 -.11442074542191647264783072544598E-18_dp, +.25371823879566853500524018479923E-20_dp, &
 +.13205328154805359813278863389097E-19_dp, +.62930261081586809166287426789485E-20_dp, &
 +.17688270424882713734999261332548E-20_dp, +.23266187985146045209674296887432E-21_dp, &
 -.67803060811125233043773831844113E-22_dp, -.59440876959676373802874150531891E-22_dp, &
 -.23618214531184415968532592503466E-22_dp, -.60214499724601478214168478744576E-23_dp, &
 -.65517906474348299071370444144639E-24_dp, +.29388755297497724587042038699349E-24_dp, &
 +.22601606200642115173215728758510E-24_dp, +.89534369245958628745091206873087E-25_dp, &
 +.24015923471098457555772067457706E-25_dp, +.34118376888907172955666423043413E-26_dp, &
 -.71617071694630342052355013345279E-27_dp, -.75620390659281725157928651980799E-27_dp, &
 -.33774612157467324637952920780800E-27_dp, -.10479325703300941711526430332245E-27_dp, &
 -.21654550252170342240854880201386E-28_dp, -.75297125745288269994689298432000E-30_dp, &
 +.19103179392798935768638084000426E-29_dp, +.11492104966530338547790728833706E-29_dp, &
 +.43896970582661751514410359193600E-30_dp, +.12320883239205686471647157725866E-30_dp, &
 +.22220174457553175317538581162666E-31_dp /)
REAL (dp), PARAMETER  :: ae12cs(41) = (/ +.63629589796747038767129887806803_dp,  &
 -.13081168675067634385812671121135E+0_dp, -.84367410213053930014487662129752E-2_dp,   &
 +.26568491531006685413029428068906E-2_dp, +.32822721781658133778792170142517E-3_dp,   &
 -.23783447771430248269579807851050E-4_dp, -.11439804308100055514447076797047E-4_dp,   &
 -.14405943433238338455239717699323E-5_dp, +.52415956651148829963772818061664E-8_dp,   &
 +.38407306407844323480979203059716E-7_dp, +.85880244860267195879660515759344E-8_dp,   &
 +.10219226625855003286339969553911E-8_dp, +.21749132323289724542821339805992E-10_dp,  &
 -.22090238142623144809523503811741E-10_dp, -.63457533544928753294383622208801E-11_dp, &
 -.10837746566857661115340539732919E-11_dp, -.11909822872222586730262200440277E-12_dp, &
 -.28438682389265590299508766008661E-14_dp, +.25080327026686769668587195487546E-14_dp, &
 +.78729641528559842431597726421265E-15_dp, +.15475066347785217148484334637329E-15_dp, &
 +.22575322831665075055272608197290E-16_dp, +.22233352867266608760281380836693E-17_dp, &
 +.16967819563544153513464194662399E-19_dp, -.57608316255947682105310087304533E-19_dp, &
 -.17591235774646878055625369408853E-19_dp, -.36286056375103174394755328682666E-20_dp, &
 -.59235569797328991652558143488000E-21_dp, -.76030380926310191114429136895999E-22_dp, &
 -.62547843521711763842641428479999E-23_dp, +.25483360759307648606037606400000E-24_dp, &
 +.25598615731739857020168874666666E-24_dp, +.71376239357899318800207052800000E-25_dp, &
 +.14703759939567568181578956800000E-25_dp, +.25105524765386733555198634666666E-26_dp, &
 +.35886666387790890886583637333333E-27_dp, +.39886035156771301763317759999999E-28_dp, &
 +.21763676947356220478805333333333E-29_dp, -.46146998487618942367607466666666E-30_dp, &
 -.20713517877481987707153066666666E-30_dp, -.51890378563534371596970666666666E-31_dp /)
REAL (dp), PARAMETER  :: e11cs(29) = (/ -.16113461655571494025720663927566180E+2_dp,      &
 +.77940727787426802769272245891741497E+1_dp, -.19554058188631419507127283812814491E+1_dp,   &
 +.37337293866277945611517190865690209E+0_dp, -.56925031910929019385263892220051166E-1_dp,   &
 +.72110777696600918537847724812635813E-2_dp, -.78104901449841593997715184089064148E-3_dp,   &
 +.73880933562621681878974881366177858E-4_dp, -.62028618758082045134358133607909712E-5_dp,   &
 +.46816002303176735524405823868362657E-6_dp, -.32092888533298649524072553027228719E-7_dp,   &
 +.20151997487404533394826262213019548E-8_dp, -.11673686816697793105356271695015419E-9_dp,   &
 +.62762706672039943397788748379615573E-11_dp, -.31481541672275441045246781802393600E-12_dp, &
 +.14799041744493474210894472251733333E-13_dp, -.65457091583979673774263401588053333E-15_dp, &
 +.27336872223137291142508012748799999E-16_dp, -.10813524349754406876721727624533333E-17_dp, &
 +.40628328040434303295300348586666666E-19_dp, -.14535539358960455858914372266666666E-20_dp, &
 +.49632746181648636830198442666666666E-22_dp, -.16208612696636044604866560000000000E-23_dp, &
 +.50721448038607422226431999999999999E-25_dp, -.15235811133372207813973333333333333E-26_dp, &
 +.44001511256103618696533333333333333E-28_dp, -.12236141945416231594666666666666666E-29_dp, &
 +.32809216661066001066666666666666666E-31_dp, -.84933452268306432000000000000000000E-33_dp /)
REAL (dp), PARAMETER  :: e12cs(25) = (/ -.3739021479220279511668698204827E-1_dp,      &
 +.4272398606220957726049179176528E-1_dp, -.130318207984970054415392055219726_dp,     &
 +.144191240246988907341095893982137E-1_dp, -.134617078051068022116121527983553E-2_dp,   &
 +.107310292530637799976115850970073E-3_dp, -.742999951611943649610283062223163E-5_dp,   &
 +.453773256907537139386383211511827E-6_dp, -.247641721139060131846547423802912E-7_dp,   &
 +.122076581374590953700228167846102E-8_dp, -.548514148064092393821357398028261E-10_dp,  &
 +.226362142130078799293688162377002E-11_dp, -.863589727169800979404172916282240E-13_dp, &
 +.306291553669332997581032894881279E-14_dp, -.101485718855944147557128906734933E-15_dp, &
 +.315482174034069877546855328426666E-17_dp, -.923604240769240954484015923200000E-19_dp, &
 +.255504267970814002440435029333333E-20_dp, -.669912805684566847217882453333333E-22_dp, &
 +.166925405435387319431987199999999E-23_dp, -.396254925184379641856000000000000E-25_dp, &
 +.898135896598511332010666666666666E-27_dp, -.194763366993016433322666666666666E-28_dp, &
 +.404836019024630033066666666666666E-30_dp, -.807981567699845120000000000000000E-32_dp /)
REAL (dp), PARAMETER  :: ae13cs(50) = (/ -.60577324664060345999319382737747_dp,  &
 -.11253524348366090030649768852718E+0_dp, +.13432266247902779492487859329414E-1_dp,   &
 -.19268451873811457249246838991303E-2_dp, +.30911833772060318335586737475368E-3_dp,   &
 -.53564132129618418776393559795147E-4_dp, +.98278128802474923952491882717237E-5_dp,   &
 -.18853689849165182826902891938910E-5_dp, +.37494319356894735406964042190531E-6_dp,   &
 -.76823455870552639273733465680556E-7_dp, +.16143270567198777552956300060868E-7_dp,   &
 -.34668022114907354566309060226027E-8_dp, +.75875420919036277572889747054114E-9_dp,   &
 -.16886433329881412573514526636703E-9_dp, +.38145706749552265682804250927272E-10_dp,  &
 -.87330266324446292706851718272334E-11_dp, +.20236728645867960961794311064330E-11_dp, &
 -.47413283039555834655210340820160E-12_dp, +.11221172048389864324731799928920E-12_dp, &
 -.26804225434840309912826809093395E-13_dp, +.64578514417716530343580369067212E-14_dp, &
 -.15682760501666478830305702849194E-14_dp, +.38367865399315404861821516441408E-15_dp, &
 -.94517173027579130478871048932556E-16_dp, +.23434812288949573293896666439133E-16_dp, &
 -.58458661580214714576123194419882E-17_dp, +.14666229867947778605873617419195E-17_dp, &
 -.36993923476444472706592538274474E-18_dp, +.93790159936721242136014291817813E-19_dp, &
 -.23893673221937873136308224087381E-19_dp, +.61150624629497608051934223837866E-20_dp, &
 -.15718585327554025507719853288106E-20_dp, +.40572387285585397769519294491306E-21_dp, &
 -.10514026554738034990566367122773E-21_dp, +.27349664930638667785806003131733E-22_dp, &
 -.71401604080205796099355574271999E-23_dp, +.18705552432235079986756924211199E-23_dp, &
 -.49167468166870480520478020949333E-24_dp, +.12964988119684031730916087125333E-24_dp, &
 -.34292515688362864461623940437333E-25_dp, +.90972241643887034329104820906666E-26_dp, &
 -.24202112314316856489934847999999E-26_dp, +.64563612934639510757670475093333E-27_dp, &
 -.17269132735340541122315987626666E-27_dp, +.46308611659151500715194231466666E-28_dp, &
 -.12448703637214131241755170133333E-28_dp, +.33544574090520678532907007999999E-29_dp, &
 -.90598868521070774437543935999999E-30_dp, +.24524147051474238587273216000000E-30_dp, &
 -.66528178733552062817107967999999E-31_dp /)
REAL (dp), PARAMETER  :: ae14cs(64) = (/ -.1892918000753016825495679942820_dp, &
 -.8648117855259871489968817056824E-1_dp, +.7224101543746594747021514839184E-2_dp,   &
 -.8097559457557386197159655610181E-3_dp, +.1099913443266138867179251157002E-3_dp,   &
 -.1717332998937767371495358814487E-4_dp, +.2985627514479283322825342495003E-5_dp,   &
 -.5659649145771930056560167267155E-6_dp, +.1152680839714140019226583501663E-6_dp,   &
 -.2495030440269338228842128765065E-7_dp, +.5692324201833754367039370368140E-8_dp,   &
 -.1359957664805600338490030939176E-8_dp, +.3384662888760884590184512925859E-9_dp,   &
 -.8737853904474681952350849316580E-10_dp, +.2331588663222659718612613400470E-10_dp, &
 -.6411481049213785969753165196326E-11_dp, +.1812246980204816433384359484682E-11_dp, &
 -.5253831761558460688819403840466E-12_dp, +.1559218272591925698855028609825E-12_dp, &
 -.4729168297080398718476429369466E-13_dp, +.1463761864393243502076199493808E-13_dp, &
 -.4617388988712924102232173623604E-14_dp, +.1482710348289369323789239660371E-14_dp, &
 -.4841672496239229146973165734417E-15_dp, +.1606215575700290408116571966188E-15_dp, &
 -.5408917538957170947895023784252E-16_dp, +.1847470159346897881370231402310E-16_dp, &
 -.6395830792759094470500610425050E-17_dp, +.2242780721699759457250233276170E-17_dp, &
 -.7961369173983947552744555308646E-18_dp, +.2859308111540197459808619929272E-18_dp, &
 -.1038450244701137145900697137446E-18_dp, +.3812040607097975780866841008319E-19_dp, &
 -.1413795417717200768717562723696E-19_dp, +.5295367865182740958305442594815E-20_dp, &
 -.2002264245026825902137211131439E-20_dp, +.7640262751275196014736848610918E-21_dp, &
 -.2941119006868787883311263523362E-21_dp, +.1141823539078927193037691483586E-21_dp, &
 -.4469308475955298425247020718489E-22_dp, +.1763262410571750770630491408520E-22_dp, &
 -.7009968187925902356351518262340E-23_dp, +.2807573556558378922287757507515E-23_dp, &
 -.1132560944981086432141888891562E-23_dp, +.4600574684375017946156764233727E-24_dp, &
 -.1881448598976133459864609148108E-24_dp, +.7744916111507730845444328478037E-25_dp, &
 -.3208512760585368926702703826261E-25_dp, +.1337445542910839760619930421384E-25_dp, &
 -.5608671881802217048894771735210E-26_dp, +.2365839716528537483710069473279E-26_dp, &
 -.1003656195025305334065834526856E-26_dp, +.4281490878094161131286642556927E-27_dp, &
 -.1836345261815318199691326958250E-27_dp, +.7917798231349540000097468678144E-28_dp, &
 -.3431542358742220361025015775231E-28_dp, +.1494705493897103237475066008917E-28_dp, &
 -.6542620279865705439739042420053E-29_dp, +.2877581395199171114340487353685E-29_dp, &
 -.1271557211796024711027981200042E-29_dp, +.5644615555648722522388044622506E-30_dp, &
 -.2516994994284095106080616830293E-30_dp, +.1127259818927510206370368804181E-30_dp, &
 -.5069814875800460855562584719360E-31_dp /)
!***FIRST EXECUTABLE STATEMENT  DE1
IF (first) THEN
  eta = 0.1 * EPSILON(0.0_dp)
  ntae10 = initds(ae10cs, 50, eta)
  ntae11 = initds(ae11cs, 60, eta)
  ntae12 = initds(ae12cs, 41, eta)
  nte11 = initds(e11cs, 29, eta)
  nte12 = initds(e12cs, 25, eta)
  ntae13 = initds(ae13cs, 50, eta)
  ntae14 = initds(ae14cs, 64, eta)
  xmaxt = -LOG( TINY(0.0_dp) )
  xmax = xmaxt - LOG(xmaxt)
END IF
first = .false.
IF (x <= -1._dp) THEN
  IF (x <= -32._dp) THEN
    fn_val = EXP(-x) / x * (1._dp + dcsevl(64._dp/x+1._dp, ae10cs, ntae10))
    RETURN
  END IF
  IF (x <= -8._dp) THEN
    fn_val = EXP(-x) / x * (1._dp + dcsevl((64._dp/x+5._dp)/3._dp, ae11cs, ntae11))
    RETURN
  END IF
  IF (x <= -4._dp) THEN
    fn_val = EXP(-x) / x * (1._dp + dcsevl(16._dp/x+3._dp, ae12cs, ntae12))
    RETURN
  END IF
  fn_val = -LOG(-x) + dcsevl((2._dp*x+5._dp)/3._dp, e11cs, nte11)
  RETURN
END IF
IF (x <= 1.0_dp) THEN
  IF (x == 0._dp) CALL xermsg('SLATEC', 'DE1', 'X IS 0')
  fn_val = (-LOG(ABS(x)) - 0.6875_dp+x) + dcsevl(x, e12cs, nte12)
  RETURN
END IF
IF (x <= 4.0_dp) THEN
  fn_val = EXP(-x) / x * (1._dp + dcsevl((8._dp/x-5._dp)/3._dp, ae13cs, ntae13))
  RETURN
END IF
IF (x <= xmax) THEN
  fn_val = EXP(-x) / x * (1._dp + dcsevl(8._dp/x-1._dp, ae14cs, ntae14))
  RETURN
END IF
CALL xermsg('SLATEC', 'DE1', 'X SO BIG E1 UNDERFLOWS')
fn_val = 0._dp
RETURN
END FUNCTION de1
!DECK DEI
FUNCTION dei(x) RESULT(fn_val)
!***BEGIN PROLOGUE  DEI
!***PURPOSE  Compute the exponential integral Ei(X).
!***LIBRARY   SLATEC (FNLIB)
!***CATEGORY  C5
!***TYPE      REAL (dp) (EI-S, DEI-D)
!***KEYWORDS  EI FUNCTION, EXPONENTIAL INTEGRAL, FNLIB,
!             SPECIAL FUNCTIONS
!***AUTHOR  Fullerton, W., (LANL)
!***DESCRIPTION
! DEI calculates the REAL (dp) exponential integral, Ei(X), for
! positive REAL (dp) argument X and the Cauchy principal value
! for negative X.  If principal values are used everywhere, then, for
! all X,
!    Ei(X) = -E1(-X)
! or
!    E1(X) = -Ei(-X).
!***REFERENCES  (NONE)
!***ROUTINES CALLED  DE1
!***REVISION HISTORY  (YYMMDD)
!   770701  DATE WRITTEN
!   891115  Modified prologue description.  (WRB)
!   891115  REVISION DATE from Version 3.2
!   891214  Prologue converted to Version 4.0 format.  (BAB)
!***END PROLOGUE  DEI
REAL (dp), INTENT(IN)  :: x
REAL (dp)              :: fn_val
!***FIRST EXECUTABLE STATEMENT  DEI
fn_val = -de1(-x)
RETURN
END FUNCTION dei
!DECK INITDS
FUNCTION initds(os, nos, eta) RESULT(ival)
!***BEGIN PROLOGUE  INITDS
!***PURPOSE  Determine the number of terms needed in an orthogonal
!            polynomial series so that it meets a specified accuracy.
!***LIBRARY   SLATEC (FNLIB)
!***CATEGORY  C3A2
!***TYPE      REAL (dp) (INITS-S, INITDS-D)
!***KEYWORDS  CHEBYSHEV, FNLIB, INITIALIZE, ORTHOGONAL POLYNOMIAL,
!             ORTHOGONAL SERIES, SPECIAL FUNCTIONS
!***AUTHOR  Fullerton, W., (LANL)
!***DESCRIPTION
!  Initialize the orthogonal series, represented by the array OS, so that
!  INITDS is the number of terms needed to insure the error is no larger than
!  ETA.  Ordinarily, ETA will be chosen to be one-tenth machine precision.
!             Input Arguments --
!   OS     REAL (dp) array of NOS coefficients in an orthogonal series.
!   NOS    number of coefficients in OS.
!   ETA    single precision scalar containing requested accuracy of series.
!***REFERENCES  (NONE)
!***ROUTINES CALLED  XERMSG
!***REVISION HISTORY  (YYMMDD)
!   770601  DATE WRITTEN
!   890531  Changed all specific intrinsics to generic.  (WRB)
!   890831  Modified array declarations.  (WRB)
!   891115  Modified error message.  (WRB)
!   891115  REVISION DATE from Version 3.2
!   891214  Prologue converted to Version 4.0 format.  (BAB)
!   900315  CALLs to XERROR changed to CALLs to XERMSG.  (THJ)
!***END PROLOGUE  INITDS
REAL (dp), INTENT(IN)  :: os(:)
INTEGER, INTENT(IN)    :: nos
REAL (dp), INTENT(IN)  :: eta
INTEGER                :: ival
INTEGER    :: i, ii
REAL (dp)  :: ERR
!***FIRST EXECUTABLE STATEMENT  INITDS
IF (nos < 1) CALL xermsg('SLATEC', 'INITDS', 'Number of coefficients < 1')
ERR = 0.0_dp
DO  ii = 1, nos
  i = nos + 1 - ii
  ERR = ERR + ABS(os(i))
  IF (ERR > eta) GO TO 20
END DO
20 IF (i == nos) CALL xermsg('SLATEC', 'INITDS',  &
    'Chebyshev series too short for specified accuracy')
ival = i
RETURN
END FUNCTION initds

SUBROUTINE xermsg(text1, text2, text3)
CHARACTER (LEN= *), INTENT(IN)  :: text1
CHARACTER (LEN= *), INTENT(IN)  :: text2
CHARACTER (LEN= *), INTENT(IN)  :: text3
WRITE(*, '(6a)') ' Error in call to ', text1, ' routine: ', text2, ' Mesg: ', text3
return
END SUBROUTINE xermsg


end module specialinf
